# B200使用指南

本教程基于本机 `/Users/你的用户名/B200` 的实际操作流程，按“从零配置到与 GitHub 同步”的顺序整理，最后附上日常使用的简明操作手册。

---

## 0. 北极星 Windows 登录与文件传输（参考 PPT）

以下内容整理自《北极星windows登陆和文件传输.pptx》，仅供配置参考；账号/密码/链接可能调整，请以管理员最新通知为准。

### 0.1 SSLVPN 登录（进入北极星网络）

1) 访问以下任一地址（下载/登录 VPN）：  
- `https://162.105.160.15:6443/`  
- `https://162.105.250.5:6443/`  
- `https://221.216.6.54:6443/`

2) 浏览器建议：Chrome / 360 / IE / Firefox。  
3) 首次使用需要安装插件与网卡驱动，若出现驱动签名提示请选择“确定/允许”。  
4) 登录（示例账号）：  
- 用户名：`teach_pkuhpc`  
- 密码：`Brysj@2020`

### 0.2 堡垒机登录入口

- SSH 登录：  
  - `ssh test_pkuhpc@10.100.1.88`（login10/login15）  
  - 或 `ssh test_pkuhpc2@10.100.1.88`（login06/login14）  
  - 密码：`Brysj@2020`
- Web 登录：`https://10.100.1.88`  
- Windows 推荐客户端：Xshell / MobaXterm  
- macOS / Linux：终端直接 SSH

示例：

```bash
ssh -o HostKeyAlgorithms=+ssh-rsa 你的用户名@10.100.1.89
```

### 0.3 使用 VS Code + SFTP 同步数据

完成 SSLVPN 与堡垒机连通后，可使用 VS Code 进行文件同步。

1) 打开 VS Code，新建本地文件夹（例如 `B200`），进入该文件夹。  
2) 打开“扩展”，安装 `SFTP` 插件。  
3) 使用快捷键 `Ctrl+Shift+P` 搜索 `SFTP: Config`，生成 `sftp.json`。  
4) 将配置替换为以下内容（把 `scfm_mjt` 改为你自己的用户名）：  

```json
{
    "name": "PKU_HPC",
    "host": "10.100.1.89",
    "protocol": "sftp",
    "port": 22,
    "username": "scfm_mjt/12.33.1.2/tangc_pkuhpc",
    "remotePath": "/vllm/tangc_pkuhpc/colony/",
    "uploadOnSave": true,
    "useSSHConfig": false
}
```

5) 保存后即可通过 SFTP 同步文件（`uploadOnSave: true` 表示保存即上传）。

---

## A. 前置检查

1) 确认 Git 已安装：

```bash
git --version
```

2) 确认当前目录与仓库根目录：

```bash
pwd
git rev-parse --show-toplevel
```

如果提示 `not a git repository`，说明还未初始化或仓库损坏。

---

## B. 初始化仓库（或修复仓库）

### 1) 正常初始化

```bash
git init
git branch -M main
git status
```

### 2) 仓库损坏时的处理（例如 `.git/HEAD` 异常）

若发现 `.git` 存在但 `git status` 报错，可重建仓库（会清空旧 Git 历史）：

```bash
rm -rf .git
git init
git branch -M main
git status
```

---

## C. 配置提交作者信息（全局）

```bash
git config --global user.name "你的名字"
git config --global user.email "你@example.com"
```

检查配置：

```bash
git config --list --show-origin
```

---

## D. 设置 SSH 密钥并连通 GitHub

### 1) 生成密钥

```bash
ssh-keygen -t ed25519 -C "你@example.com" -f ~/.ssh/id_ed25519 -N ""
```

### 2) 添加公钥到 GitHub

```bash
cat ~/.ssh/id_ed25519.pub
```

把输出内容粘贴到 GitHub：
`Settings -> SSH and GPG keys -> New SSH key`

### 3) 解决 22 端口被封的情况（改用 443）

如果 `ssh -T git@github.com` 失败，可在 `~/.ssh/config` 增加：

```ssh
Host github.com
  HostName ssh.github.com
  Port 443
  User git
```

然后测试：

```bash
ssh -T git@github.com
```

正常会返回：

```
Hi 你的GitHub用户名! You've successfully authenticated...
```

---

## E. 绑定 GitHub 远程仓库

仓库为私有仓库也完全可以推送，前提是有权限。

```bash
git remote add origin git@github.com:你的GitHub用户名/B200.git
```

检查：

```bash
git remote -v
```

如果之前设置错了地址：

```bash
git remote set-url origin git@github.com:你的GitHub用户名/B200.git
```

---

## F. 首次提交与推送（只推送指南文件）

1) 添加文件并提交：

```bash
git add B200使用指南.md
git commit -m "docs: add initial setup guide"
```

2) 首次推送：

```bash
git push -u origin main
```

### 如果远程仓库已有 README 或 LICENSE

如果远程已有文件，本地的同名文件可能阻止 `pull/rebase`。处理方式：

```bash
mv README.md README.md.local

git fetch origin
git rebase origin/main
```

处理完成后按需删除本地备份：

```bash
rm -f README.md.local
```

---

## G. 建议添加 .gitignore

防止提交缓存、虚拟环境、训练输出等文件：

```bash
cat <<'EOG' > .gitignore
# Python
__pycache__/
*.py[cod]
.venv/
venv/

# Jupyter
.ipynb_checkpoints/

# Build / dist
build/
dist/

# Logs & caches
*.log
.cache/

# OS
.DS_Store

# Local configs
sftp.json

# Training outputs
outputs/
checkpoints/
runs/
wandb/
EOG
```

---

# tmux 常见需求（已在会话中运行程序）

在你已经进入一个 tmux 会话并在里面跑程序的情况下，常见两种需求：

## 1) 只想再开一个“终端标签页”（同一会话内）

最推荐做法：在当前 tmux 会话里新建窗口，不需要退出也不需要重连。

```text
Ctrl+b
c
```

效果：
- 当前会话多一个新窗口（类似新的 tab）
- 原窗口里的程序继续跑，不受影响

切换窗口：

```text
Ctrl+b n   # 下一个窗口
Ctrl+b p   # 上一个窗口
Ctrl+b w   # 列出所有窗口，用方向键选
```

## 2) 想新建一个“完全独立的 tmux 会话”

### 情况 A：你还有一个不在 tmux 里的终端

```bash
tmux new -s new_session_name
```

原会话继续在后台跑，不受影响。查看/切换会话：

```bash
tmux ls
tmux attach -t 会话名
```

### 情况 B：你现在只有这一个 tmux 终端

先把当前会话挂后台（程序照跑）：

```text
Ctrl+b d
```

再新建一个会话：

```bash
tmux new -s new_session_name
```

之后切换不同会话：

```bash
tmux ls
tmux attach -t 会话名
```

或在 tmux 里直接切换已有会话：

```text
Ctrl+b s    # 弹出会话列表，用方向键选
```

简单总结：
- 只是想再开一个终端环境：优先用窗口 `Ctrl+b c`
- 需要多个独立会话：`tmux new -s ...`，再 `tmux attach -t ...` 切换

# 日常 Git 简明指南

## 1) 查看改动

```bash
git status
git diff
git diff --staged
```

## 2) 提交流程

```bash
git add <file>
git commit -m "feat: your message"
git push
```

## 3) 创建分支

```bash
git checkout -b feature/xxx
# 或
# git switch -c feature/xxx
```

## 4) 拉取更新

```bash
git pull
# 如要求线性历史：
# git pull --rebase
```

## 5) 回滚与恢复

撤销未暂存改动：

```bash
git restore <file>
```

撤销暂存：

```bash
git restore --staged <file>
```

回退到某次提交（保留改动）：

```bash
git reset --soft <commit>
```

生成反向提交（适合已推送）：

```bash
git revert <commit>
```

## 6) 查看历史

```bash
git log --oneline --decorate --graph
git show <commit>
git blame <file>
```

## 7) 暂存改动（stash）

```bash
git stash
git stash list
git stash pop
```

---

如需进一步规范化（分支模型、提交规范、PR 模板、CI 检查等），可在此基础上扩展。
